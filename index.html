<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéß Nekohacker591 Portfolio</title>
  <meta name="title" content="üéß Nekohacker591 Portfolio" />
  <meta name="description" content="Welcome to Nekohacker's portfolio where I post my music to share with others without compression from platforms." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://nekohackers-music.onrender.com/" />
  <meta property="og:title" content="üéß Nekohacker591 Portfolio" />
  <meta property="og:description" content="Welcome to Nekohacker's portfolio where I post my music to share with others without compression from platforms." />
  <meta property="og:image" content="https://i.imgur.com/ClMFeop.png" />
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://nekohackers-music.onrender.com/" />
  <meta property="twitter:title" content="üéß Nekohacker591 Portfolio" />
  <meta property="twitter:description" content="Welcome to Nekohacker's portfolio where I post my music to share with others without compression from platforms." />
  <meta property="twitter:image" content="https://i.imgur.com/ClMFeop.png" />

  <style>
    :root {
      --primary-color: #007bff;
      --primary-color-hover: #0056b3;
      --background-color: #f6f8fa; /* Fallback page background color */
      --sidebar-bg: #ffffff;
      --content-bg: #ffffff;
      --surface-highlight: #e1e4e8;
      --text-color: #24292e;
      --text-secondary-color: #586069;
      --text-link-color: #0366d6;
      --button-bg: #2ea44f;
      --button-bg-hover: #2c974b;
      --button-text-color: #ffffff;
      --border-radius: 6px;
      --transition-speed: 0.2s ease-in-out;
      --sidebar-width: 260px;
      --header-height: 60px;

      /* --- PAGE BACKGROUND IMAGE --- */
      /* Example: --page-background-image: url('https://example.com/your-cool-bg.jpg'); */
      --page-background-image: none; /* Set to 'none' or remove if no image desired */

      /* --- ICON DEFINITIONS (Can be emoji OR url()) --- */
      /* Example image URLs (replace with your actual image paths) */
      /* --icon-home: url('icons/home.svg'); */
      /* --icon-music: url('icons/music.svg'); */
      /* --icon-play: url('https://github.com/nekohacker591/nekohackers-music/raw/refs/heads/main/Icons/Play_btn.webp'); */
      /* --icon-pause: url('icons/pause.svg'); */
      /* --icon-download: url('icons/download.svg'); */
      /* --icon-share: url('icons/share.svg'); */
      /* --icon-mute: url('icons/mute.svg'); */
      /* --icon-unmute: url('icons/unmute.svg'); */
      /* --icon-hamburger: url('icons/hamburger.svg'); */
      /* --icon-close: url('icons/close.svg'); */

      /* Fallback Emoji/Text Icons */
      --icon-home: üè†;
      --icon-music: üéµ;
      --icon-play: url('https://github.com/nekohacker591/nekohackers-music/raw/refs/heads/main/Icons/Play_btn.png');
     /* --icon-play: ‚ñ∂; */
      --icon-pause: ‚ñÆ‚ñÆ;
      --icon-download: ‚¨áÔ∏è;
      --icon-share: üîó;
      --icon-mute: üîá;
      --icon-unmute: üîä;
      --icon-hamburger: ‚ò∞;
      --icon-close: ‚úï;

      /* Default size for image icons */
      --icon-image-width: 20px;
      --icon-image-height: 20px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      background-color: var(--background-color); /* Fallback */
      background-image: var(--page-background-image);
      background-size: cover;
      background-position: center center;
      background-attachment: fixed;
      color: var(--text-color);
      margin: 0;
      display: flex;
      height: 100vh;
      overflow-x: hidden;
    }

    /* Styling for icon spans when they use an image */
    .icon.image-icon {
        display: inline-block;
        width: var(--icon-image-width);
        height: var(--icon-image-height);
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        vertical-align: middle;
        font-size: 0; /* Hide text if any was there by mistake */
    }
    .play-btn .icon.image-icon,
    .mute-btn .icon.image-icon {
        width: 100%; /* Fill button if icon-only */
        height: 100%;
    }


    #sidebar-toggle {
      position: fixed; top: 15px; left: 15px; z-index: 1001; background: var(--content-bg);
      border: 1px solid var(--surface-highlight); color: var(--text-color); font-size: 20px;
      width: 40px; height: 40px; border-radius: var(--border-radius); cursor: pointer;
      display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    #sidebar-toggle .icon { font-size: inherit; }
    #sidebar-toggle:hover { background-color: #f0f0f0; }

    #sidebar {
      width: var(--sidebar-width); background-color: var(--sidebar-bg);
      border-right: 1px solid var(--surface-highlight); padding: 20px; padding-top: 70px;
      height: 100vh; box-sizing: border-box; position: fixed; left: 0; top: 0;
      transform: translateX(-100%); transition: transform 0.3s ease-in-out; z-index: 1000; overflow-y: auto;
    }
    body.sidebar-open #sidebar { transform: translateX(0); }
    body.sidebar-open #main-content-area { margin-left: var(--sidebar-width); }
    @media (min-width: 769px) {
        #sidebar-toggle { display: none; }
        #sidebar { transform: translateX(0); }
        #main-content-area { margin-left: var(--sidebar-width); }
    }

    .sidebar-header h2 { font-size: 1.5em; color: var(--text-color); margin-top: 0; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--surface-highlight); }
    #sidebar nav a.nav-link { display: flex; align-items: center; padding: 10px 12px; margin-bottom: 8px; text-decoration: none; color: var(--text-color); border-radius: var(--border-radius); font-size: 16px; transition: background-color var(--transition-speed), color var(--transition-speed); }
    #sidebar nav a.nav-link .icon { margin-right: 10px; min-width: var(--icon-image-width); text-align: center; }
    #sidebar nav a.nav-link:hover { background-color: #f0f0f0; }
    #sidebar nav a.nav-link.active { background-color: var(--primary-color); color: var(--button-text-color); font-weight: 600; }
    #sidebar nav a.nav-link.active .icon { color: var(--button-text-color); }

    .sidebar-controls { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--surface-highlight); }
    .sidebar-controls label { display: flex; align-items: center; font-size: 14px; color: var(--text-secondary-color); cursor: pointer; }
    .sidebar-controls input[type="checkbox"] { accent-color: var(--primary-color); margin-right: 8px; transform: scale(1.1); }

    #main-content-area { flex-grow: 1; padding: 20px; padding-top: 20px; transition: margin-left 0.3s ease-in-out; box-sizing: border-box; overflow-y: auto; height: 100vh; }
    @media (max-width: 768px) { #main-content-area { padding-top: 70px; } }
    
    .main-header-content h1 { color: var(--text-color); text-align: center; margin-bottom: 30px; font-weight: 600; }
    .tab-content { display: none; width: 100%; max-width: 750px; margin: 0 auto; }
    .tab-content.active { display: block; }

    #home-content { padding: 20px; background-color: var(--content-bg); border-radius: var(--border-radius); box-shadow: 0 1px 3px rgba(27,31,35,0.1); border: 1px solid var(--surface-highlight); }
    #home-content p, #home-content ul { margin-bottom: 1em; color: var(--text-secondary-color); }
    #home-content h2 { color: var(--text-color); margin-top: 0; }
    #home-content li { margin-bottom: 0.5em;}

    .search-bar { margin-bottom: 20px; width: 100%; }
    .search-input { width: 100%; padding: 10px 12px; font-size: 14px; border: 1px solid var(--surface-highlight); border-radius: var(--border-radius); background-color: var(--sidebar-bg);  color: var(--text-color); box-shadow: inset 0 1px 2px rgba(27,31,35,0.075); transition: border-color var(--transition-speed), box-shadow var(--transition-speed); }
    .search-input:focus { outline: none; border-color: var(--primary-color); box-shadow: inset 0 1px 2px rgba(27,31,35,0.075), 0 0 0 3px rgba(3,102,214,0.3); }

    #song-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px; }
    .song-item a { display: block; padding: 12px 15px; background-color: var(--content-bg); color: var(--text-link-color); text-decoration: none; border-radius: var(--border-radius); border: 1px solid var(--surface-highlight); transition: border-color var(--transition-speed), box-shadow var(--transition-speed); font-size: 16px; font-weight: 500; }
    .song-item a:hover { border-color: var(--primary-color); box-shadow: 0 1px 5px rgba(3,102,214,0.15); }
    .song-item-empty { padding: 15px 20px; color: var(--text-secondary-color); text-align: center; }

    .player { background-color: var(--content-bg); padding: 20px; border-radius: var(--border-radius); box-shadow: 0 3px 6px rgba(27,31,35,0.1); border: 1px solid var(--surface-highlight); width: 100%; box-sizing: border-box; margin-top: 20px; }
    .player.player-playing { border-color: var(--primary-color); }
    .track-title { font-size: 20px; margin-bottom: 15px; color: var(--text-color); font-weight: 600; text-align: center; }
    .controls { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
    
    .play-btn { background-color: var(--button-bg); border: 1px solid rgba(27,31,35,0.15); color: var(--button-text-color); width: 48px; height: 48px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background-color var(--transition-speed); box-shadow: 0 1px 0 rgba(27,31,35,0.04), inset 0 1px 0 hsla(0,0%,100%,0.25); padding: 0; }
    .play-btn .icon { font-size: 20px; }
    .play-btn:hover { background-color: var(--button-bg-hover); }

    .progress-container { flex-grow: 1; display: flex; align-items: center; gap: 10px; }
    .progress { flex-grow: 1; height: 8px; background-color: var(--surface-highlight); border-radius: 4px; overflow: hidden; position: relative; cursor: pointer; }
    .progress-filled { height: 100%; background-color: var(--primary-color); width: 0; border-radius: 4px; transition: width 0.1s linear; }
    .current-time, .duration { font-size: 13px; color: var(--text-secondary-color); min-width: 38px; text-align: center; }

    .actions { margin-top: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center; }
    .download-link, .share-btn { background-color: #f6f8fa; border: 1px solid rgba(27,31,35,0.15); color: var(--text-color); padding: 8px 16px; border-radius: var(--border-radius); text-decoration: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color var(--transition-speed), border-color var(--transition-speed); display: inline-flex; align-items: center; gap: 6px; box-shadow: 0 1px 0 rgba(27,31,35,0.04), inset 0 1px 0 hsla(0,0%,100%,0.25); }
    .download-link .icon, .share-btn .icon { margin-right: 4px; }
    .download-link:hover, .share-btn:hover { background-color: #f0f2f4; border-color: rgba(27,31,35,0.2); }
    .copied { opacity: 0; color: var(--primary-color); font-size: 13px; transition: opacity 0.3s var(--transition-speed); margin-left: 5px; }
    .copied.show { opacity: 1; }

    .volume-container { display: flex; align-items: center; gap: 10px; margin-top: 15px; }
    .mute-btn { background-color: #f6f8fa; border: 1px solid rgba(27,31,35,0.15); color: var(--text-color); width: 38px; height: 38px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 1px 0 rgba(27,31,35,0.04), inset 0 1px 0 hsla(0,0%,100%,0.25); transition: background-color var(--transition-speed), border-color var(--transition-speed); padding: 0; }
    .mute-btn .icon { font-size: 18px; }
    .mute-btn:hover { background-color: #f0f2f4; border-color: rgba(27,31,35,0.2); }

    .volume-slider { flex-grow: 1; -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--surface-highlight); outline: none; border-radius: 3px; cursor: pointer; }
    .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--text-link-color); border-radius: 50%; cursor: pointer; border: 2px solid var(--content-bg); box-shadow: 0 1px 3px rgba(27,31,35,0.1); }
    .volume-slider::-moz-range-thumb { width: 16px; height: 16px; background: var(--text-link-color); border-radius: 50%; cursor: pointer; border: 2px solid var(--content-bg); box-shadow: 0 1px 3px rgba(27,31,35,0.1); }

    body.embed-mode { padding: 0; margin: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; background-color: var(--content-bg); background-image: none; }
    .player-embed { width: 100%; height: 100%; box-sizing: border-box; margin: 0; border-radius: 0; box-shadow: none; border: none; padding: 15px; display: flex; flex-direction: column; justify-content: center; }
    .player-embed .track-title { font-size: 18px; margin-bottom: 12px; }
    .player-embed .controls { margin-bottom: 12px; }
    .player-embed .volume-container { margin-top: 12px; }
    .player-embed .actions { display: none; }
  </style>
</head>
<body>
  <button id="sidebar-toggle" aria-label="Toggle navigation" aria-expanded="false">
    <span class="icon"></span>
  </button>

  <aside id="sidebar">
    <div class="sidebar-header">
      <h2>Navigation</h2>
    </div>
    <nav>
      <a href="#" class="nav-link" data-view="home">
        <span class="icon"></span> Home
      </a>
      <a href="#" class="nav-link" data-view="music">
        <span class="icon"></span> Music
      </a>
    </nav>
    <div class="sidebar-controls">
      <label for="autoplay-next-sidebar">
        <input type="checkbox" id="autoplay-next-sidebar">
        Autoplay Next
      </label>
    </div>
  </aside>

  <main id="main-content-area">
    <div class="main-header-content">
         <h1 id="page-title">üéß Nekohacker591 Portfolio</h1>
    </div>
    <div id="home-content" class="tab-content">
        <h2>Welcome!</h2>
        <p>Hey there, welcome to my little corner of the internet! This is where I stash all my musical creations. I got tired of platforms squashing the life out of my audio, so I built this place to share my tracks in their full, uncompressed glory.</p>
        <p>Here you can:</p>
        <ul>
            <li>Browse my latest tunes via the "Music" link in the sidebar.</li>
            <li>Listen to high-quality WAV files.</li>
            <li>Download anything you like.</li>
            <li>Share your favorites with your pals.</li>
        </ul>
        <p>Thanks for stopping by and having a listen. Hope you find something that makes your ears happy!</p>
        <p><em>- Nekohacker591</em></p>
    </div>
    <div id="music-content" class="tab-content">
        <div class="search-bar">
            <input type="text" id="music-search-input" class="search-input" placeholder="Search for a track...">
        </div>
        <ul id="song-list"></ul>
    </div>
    <div id="player-view-content" class="tab-content">
    </div>
  </main>

  <script>
    const globalPlayerState = {
        currentPlayingAudio: null,
        currentPlayingPlayerDiv: null,
        lastVolume: parseFloat(localStorage.getItem('nekohacker_globalVolume')) || 0.75,
        isMuted: JSON.parse(localStorage.getItem('nekohacker_isMuted')) || false,
        get autoplayNext() { return document.getElementById('autoplay-next-sidebar')?.checked ?? true; },
        set autoplayNext(value) {
            const cb = document.getElementById('autoplay-next-sidebar');
            if (cb) cb.checked = value;
            localStorage.setItem('nekohacker_autoplayNext', JSON.stringify(value));
        }
    };

    const songsData = [
      { title: "Rock and Roll", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/rock%20and%20roll%20mixed.wav?download=true", artwork: "https://i.imgur.com/ClMFeop.png" },
      { title: "Mesmerizer", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/vocoloid%20project%20v4.wav?download=true" },
      { title: "1 Track Chiptune", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/one%20track%20challenge.wav?download=true" },
      { title: "Eye of Horus", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/aoharutale%20eye%20of%20horus%20final%20mix.wav?download=true" },
      { title: "Eye of Horus Red Edition", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/Eye%20of%20H.O.R.U.S%20red%20edition%20MIX%20mix.wav?download=true" },
      { title: "You Will Know Our Names Recreation Attempt", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/Xenoblade%20Chronicles%20OST%20-%20You%20Will%20Know%20Our%20Names%20bootleg.wav?download=true" },
      { title: "Chill Synth Wave", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/chill%20song%20mixed.wav?download=true" },
      { title: "The Video Game Melody 2025 Edition", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/video%20game%20melody.wav?download=true" },
      { title: "Elyisan", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/idol%20song%202.wav?download=true" },
      { title: "Bang Dream", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/bang%20dream.wav?download=true" },
      { title: "Red Zone Remix", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/red%20zone%20serum%202%20evaluation%20super%20massive.wav?download=true" },
      { title: "Nee Nee Nee", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/nee%20nee%20nee%20final%20ozone%20edition.wav?download=true" },
      { title: "Circulation", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/circulation.wav?download=true" },
      { title: "Flowering Night Remix", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/flowering%20night.wav?download=true" },
      { title: "The Video Game Melody 2024 Edition ", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/mario%20melody.wav?download=true" },
      { title: "8 Bit Magic", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/8%20bit%20magic.wav?download=true" },
      { title: "Akuno Meshitsukai", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/akuno_meshitsukai%20premaster.wav?download=true" },
      { title: "Luminous Neko", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/anime%20op%202%20like%20song%20group%20master.wav?download=true" },
      { title: "Nekos's Bon App√©tit‚ô°", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/anime%20op%20after%20mastering.wav?download=true" },
      { title: "Do-Dai Neko Joy", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/do-dai%20neko%20joy%20remix%20trail%20test.wav?download=true" },
      { title: "Neko No Yorokobi", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/Neko%20no%20yorokobi.wav?download=true" },
      { title: "Save The World", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/good%20remix%20rock%20sprit%20rock.wav?download=true" },
      { title: "The Joker", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/joker%20game%20song.wav?download=true" },
      { title: "Ely Dreamy", file: "https://huggingface.co/datasets/nekohacker591/music/resolve/main/mus/Ely%20Dreamy.wav?download=true" }
    ];
    const defaultArtwork = 'https://i.imgur.com/ClMFeop.png';

    const sidebarToggleBtn = document.getElementById('sidebar-toggle');
    const navLinks = document.querySelectorAll('#sidebar .nav-link');
    const tabContents = document.querySelectorAll('.tab-content');
    const songListUl = document.getElementById('song-list');
    const musicSearchInput = document.getElementById('music-search-input');
    const autoplayCheckboxSidebar = document.getElementById('autoplay-next-sidebar');
    const playerViewContainer = document.getElementById('player-view-content');
    const homeContent = document.getElementById('home-content');
    const musicContent = document.getElementById('music-content');
    const pageTitleElement = document.getElementById('page-title');
    let iconMap = {};

    function getAndApplyIcon(element, cssVarName) {
        if (!element) return;
        const iconValue = iconMap[cssVarName] || getComputedStyle(document.documentElement).getPropertyValue(cssVarName).trim();
        iconMap[cssVarName] = iconValue;

        element.classList.remove('image-icon');
        element.style.backgroundImage = '';
        element.textContent = '';

        if (iconValue.toLowerCase().startsWith('url(')) {
            element.classList.add('image-icon');
            element.style.backgroundImage = iconValue;
        } else {
            element.textContent = iconValue;
        }
    }

    function updateSidebarToggleIcon() {
        const iconElement = sidebarToggleBtn.querySelector('.icon');
        const isSidebarOpen = document.body.classList.contains('sidebar-open');
        getAndApplyIcon(iconElement, isSidebarOpen ? '--icon-close' : '--icon-hamburger');
        sidebarToggleBtn.setAttribute('aria-expanded', isSidebarOpen.toString());
    }
    
    function setupIcons() {
        ['--icon-home', '--icon-music', '--icon-play', '--icon-pause', '--icon-download', '--icon-share', '--icon-mute', '--icon-unmute', '--icon-hamburger', '--icon-close'].forEach(varName => {
            iconMap[varName] = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
        });
        updateSidebarToggleIcon();
        getAndApplyIcon(document.querySelector('.nav-link[data-view="home"] .icon'), '--icon-home');
        getAndApplyIcon(document.querySelector('.nav-link[data-view="music"] .icon'), '--icon-music');
    }

    function formatTime(seconds) {
      if (isNaN(seconds) || seconds === Infinity) return '--:--';
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function createPlayerElement(track, index, isEmbedStyle = false) {
        const playerDiv = document.createElement("div");
        playerDiv.className = "player";
        if (isEmbedStyle) playerDiv.classList.add("player-embed");
        playerDiv.id = `player-${index}`;
        playerDiv.dataset.src = track.file;
        playerDiv.dataset.index = index;

        const actionsHTML = `
            <a class="download-link" href="${track.file}" download="${track.title.replace(/[^\w\s.-]/g, '') || 'track'}.wav">
                <span class="icon"></span> Download 
            </a>
            <button class="share-btn">
                <span class="icon"></span> Share
            </button>
            <span class="copied">Copied!</span>
        `;

        playerDiv.innerHTML = `
            <div class="track-title">${track.title}</div>
            <div class="controls">
                <button class="play-btn"><span class="icon"></span></button>
                <div class="progress-container">
                    <span class="current-time">0:00</span>
                    <div class="progress"><div class="progress-filled"></div></div>
                    <span class="duration">--:--</span>
                </div>
            </div>
            ${!isEmbedStyle ? `<div class="actions">${actionsHTML}</div>` : ''}
            <div class="volume-container">
                <button class="mute-btn"><span class="icon"></span></button>
                <input type="range" class="volume-slider" min="0" max="1" step="0.01" value="${globalPlayerState.lastVolume}">
            </div>
        `;

        getAndApplyIcon(playerDiv.querySelector('.play-btn .icon'), '--icon-play');
        getAndApplyIcon(playerDiv.querySelector('.mute-btn .icon'), '--icon-mute'); // Initial as mute
        if (!isEmbedStyle) {
            getAndApplyIcon(playerDiv.querySelector('.download-link .icon'), '--icon-download');
            getAndApplyIcon(playerDiv.querySelector('.share-btn .icon'), '--icon-share');
            const shareBtn = playerDiv.querySelector('.share-btn');
            const copiedMsg = playerDiv.querySelector('.copied');
            if (shareBtn && copiedMsg) {
                shareBtn.addEventListener('click', () => {
                    const playerViewUrl = new URL(window.location.origin + window.location.pathname);
                    playerViewUrl.searchParams.set('view', 'player');
                    playerViewUrl.searchParams.set('songId', index.toString());
                    navigator.clipboard.writeText(playerViewUrl.href).then(() => {
                        copiedMsg.classList.add('show');
                        setTimeout(() => copiedMsg.classList.remove('show'), 1500);
                    }).catch(err => console.error('Failed to copy share link:', err));
                });
            }
        }
        return playerDiv;
    }
    
    function initializeAudioForPlayer(playerDiv, autoPlay = false) {
      if (playerDiv.audioInitialized && playerDiv.audio && playerDiv.audio.src === playerDiv.dataset.src && !autoPlay) return;
      if (playerDiv.audio) { playerDiv.audio.pause(); playerDiv.audio.src = ""; }
      
      const audio = new Audio();
      audio.preload = "metadata";
      playerDiv.audio = audio;
      playerDiv.audioInitialized = true;

      const playBtnIconElement = playerDiv.querySelector('.play-btn .icon');
      const muteBtnIconElement = playerDiv.querySelector('.mute-btn .icon');
      const progressFilled = playerDiv.querySelector('.progress-filled');
      const progressBar = playerDiv.querySelector('.progress');
      const volumeSlider = playerDiv.querySelector('.volume-slider');
      const currentTimeDisplay = playerDiv.querySelector('.current-time');
      const durationDisplay = playerDiv.querySelector('.duration');
      const trackTitleElement = playerDiv.querySelector('.track-title');
      const songIndex = parseInt(playerDiv.dataset.index);

      audio.muted = globalPlayerState.isMuted;
      audio.volume = globalPlayerState.lastVolume;
      volumeSlider.value = globalPlayerState.lastVolume;
      getAndApplyIcon(muteBtnIconElement, globalPlayerState.isMuted ? '--icon-unmute' : '--icon-mute');
      volumeSlider.disabled = globalPlayerState.isMuted;

      audio.addEventListener('loadedmetadata', () => {
        durationDisplay.textContent = formatTime(audio.duration);
        if (autoPlay && (playerDiv.shouldAutoPlay !== false || typeof playerDiv.shouldAutoPlay === 'undefined')) {
            audio.play().catch(e => console.warn("Autoplay prevented:", e));
        }
      });
      audio.addEventListener('play', () => {
        getAndApplyIcon(playBtnIconElement, '--icon-pause');
        playerDiv.classList.add('player-playing');
        globalPlayerState.currentPlayingAudio = audio; globalPlayerState.currentPlayingPlayerDiv = playerDiv;
        if (trackTitleElement) document.title = `üéß ${trackTitleElement.textContent} - Nekohacker591`;
      });
      audio.addEventListener('pause', () => {
        getAndApplyIcon(playBtnIconElement, '--icon-play');
        playerDiv.classList.remove('player-playing');
        if (globalPlayerState.currentPlayingAudio === audio && audio.ended) {
             document.title = 'üéß Nekohacker591 Portfolio';
        }
      });
      audio.addEventListener('timeupdate', () => {
        if (audio.duration) { const percent = (audio.currentTime / audio.duration) * 100; progressFilled.style.width = percent + '%'; }
        currentTimeDisplay.textContent = formatTime(audio.currentTime);
      });
      audio.addEventListener('ended', () => {
        getAndApplyIcon(playBtnIconElement, '--icon-play');
        progressFilled.style.width = '0%'; currentTimeDisplay.textContent = formatTime(0);
        playerDiv.classList.remove('player-playing'); document.title = 'üéß Nekohacker591 Portfolio';
        if (globalPlayerState.currentPlayingPlayerDiv === playerDiv) { globalPlayerState.currentPlayingAudio = null; globalPlayerState.currentPlayingPlayerDiv = null; }
        if (globalPlayerState.autoplayNext) {
            const currentView = new URLSearchParams(window.location.search).get('view');
            if (currentView === 'player' && songIndex < songsData.length - 1) navigateToPlayerView(songIndex + 1);
        }
      });
      audio.addEventListener('volumechange', () => {
        getAndApplyIcon(muteBtnIconElement, audio.muted || audio.volume === 0 ? '--icon-unmute' : '--icon-mute');
        volumeSlider.disabled = audio.muted;
        if (!audio.muted) { volumeSlider.value = audio.volume; globalPlayerState.lastVolume = audio.volume; }
        globalPlayerState.isMuted = audio.muted;
        localStorage.setItem('nekohacker_globalVolume', globalPlayerState.lastVolume.toString());
        localStorage.setItem('nekohacker_isMuted', JSON.stringify(globalPlayerState.isMuted));
      });
      volumeSlider.addEventListener('input', () => { audio.muted = false; audio.volume = parseFloat(volumeSlider.value); });
      muteBtnIconElement.parentElement.addEventListener('click', () => { audio.muted = !audio.muted; }); // Listener on button, not icon span
      playBtnIconElement.parentElement.addEventListener('click', () => { // Listener on button
        if (!audio.src || audio.src !== playerDiv.dataset.src) audio.src = playerDiv.dataset.src;
        if (audio.paused) {
          if (globalPlayerState.currentPlayingAudio && globalPlayerState.currentPlayingAudio !== audio) {
            globalPlayerState.currentPlayingAudio.pause(); // This will trigger its pause event to update its icon
            if(globalPlayerState.currentPlayingPlayerDiv) {
                // getAndApplyIcon(globalPlayerState.currentPlayingPlayerDiv.querySelector('.play-btn .icon'), '--icon-play'); // Handled by pause event
                globalPlayerState.currentPlayingPlayerDiv.classList.remove('player-playing');
            }
          }
          audio.play().catch(e => console.error("Play failed:", e));
        } else { audio.pause(); }
      });
      progressBar.addEventListener('click', (e) => {
        if (!audio.duration || audio.duration === Infinity) return;
        const rect = progressBar.getBoundingClientRect(); const newTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
        audio.currentTime = newTime;
        if (audio.paused) { progressFilled.style.width = ((newTime / audio.duration) * 100) + '%'; currentTimeDisplay.textContent = formatTime(newTime); }
      });
      if (!audio.src && playerDiv.dataset.src) audio.src = playerDiv.dataset.src;
    }
    
    function setMetaTags(options = {}) {
        const defaults = {
            title: 'üéß Nekohacker591 Portfolio',
            description: 'Welcome to Nekohacker\'s portfolio where I post my music to share with others without compression from platforms.',
            url: window.location.origin + window.location.pathname, type: 'website', imageUrl: defaultArtwork,
            audioUrl: null, trackIdForEmbed: null, twitterCardType: 'summary_large_image'
        };
        const config = { ...defaults, ...options }; document.title = config.title;
        const head = document.head; head.querySelectorAll('meta[data-dynamic-meta]').forEach(tag => tag.remove());
        const tagsToSet = [
            { property: 'og:title', content: config.title }, { property: 'og:description', content: config.description },
            { property: 'og:url', content: config.url }, { property: 'og:type', content: config.type },
            { property: 'og:image', content: config.imageUrl }, { name: 'twitter:card', content: config.twitterCardType },
            { name: 'twitter:title', content: config.title }, { name: 'twitter:description', content: config.description },
            { name: 'twitter:image', content: config.imageUrl },
        ];
        if (config.audioUrl) { tagsToSet.push({ property: 'og:audio', content: config.audioUrl }); tagsToSet.push({ property: 'og:audio:type', content: 'audio/wav' }); }
        if (config.trackIdForEmbed !== null && songsData[config.trackIdForEmbed]) {
            const embedUrl = new URL(window.location.origin + window.location.pathname);
            embedUrl.searchParams.set('embed', config.trackIdForEmbed.toString());
            tagsToSet.push({ name: 'twitter:player', content: embedUrl.href });
            tagsToSet.push({ name: 'twitter:player:width', content: '500' }); tagsToSet.push({ name: 'twitter:player:height', content: '180' });
            const twitterCardIndex = tagsToSet.findIndex(tag => tag.name === 'twitter:card');
            if (twitterCardIndex > -1) tagsToSet[twitterCardIndex].content = 'player'; else tagsToSet.push({ name: 'twitter:card', content: 'player' });
        }
        tagsToSet.forEach(tagInfo => {
            const meta = document.createElement('meta'); meta.setAttribute('data-dynamic-meta', 'true');
            if (tagInfo.property) meta.setAttribute('property', tagInfo.property); if (tagInfo.name) meta.setAttribute('name', tagInfo.name);
            meta.setAttribute('content', tagInfo.content); head.appendChild(meta);
        });
    }

    function populateSongList(filteredSongs = songsData) {
      songListUl.innerHTML = '';
      if (filteredSongs.length === 0 && musicSearchInput.value !== '') { songListUl.innerHTML = '<li class="song-item-empty">No tracks match your search, chief.</li>'; return; }
      filteredSongs.forEach((track) => {
        const actualIndex = songsData.findIndex(s => s.file === track.file); if (actualIndex === -1) return;
        const li = document.createElement('li'); li.className = 'song-item';
        const link = document.createElement('a'); link.href = `?view=player&songId=${actualIndex}`;
        link.textContent = track.title;
        link.addEventListener('click', (e) => { e.preventDefault(); navigateToPlayerView(actualIndex); });
        li.appendChild(link); songListUl.appendChild(li);
      });
    }

    function navigateToPlayerView(songId) {
        const url = new URL(window.location);
        url.searchParams.set('view', 'player'); url.searchParams.set('songId', songId.toString());
        url.searchParams.delete('s'); url.searchParams.delete('id'); url.searchParams.delete('share');
        window.history.pushState({ view: 'player', songId: songId }, '', url); renderView();
    }

    function renderView() {
        const urlParams = new URLSearchParams(window.location.search);
        let view = urlParams.get('view');
        const songIdParam = urlParams.get('songId');
        const embedIdParam = urlParams.get('embed');
        const legacyShareIdParam = urlParams.get('id');
        const isLegacyShareMode = urlParams.get('share') === 'true';
        const searchQuery = urlParams.get('s');

        if (globalPlayerState.currentPlayingAudio && (!songIdParam || globalPlayerState.currentPlayingPlayerDiv?.dataset.index !== songIdParam)) {
            globalPlayerState.currentPlayingAudio.pause();
        }

        if (embedIdParam !== null && songsData[embedIdParam]) {
            document.body.innerHTML = ''; document.body.className = 'embed-mode';
            const track = songsData[embedIdParam]; const playerDiv = createPlayerElement(track, parseInt(embedIdParam), true);
            document.body.appendChild(playerDiv); playerDiv.shouldAutoPlay = true; initializeAudioForPlayer(playerDiv, true); return;
        }
        document.body.classList.remove('embed-mode');
        if (isLegacyShareMode && legacyShareIdParam !== null && songsData[legacyShareIdParam]) { navigateToPlayerView(parseInt(legacyShareIdParam)); return; }
        if (!view && !songIdParam) view = 'home';

        tabContents.forEach(tc => tc.classList.remove('active'));
        navLinks.forEach(link => link.classList.remove('active'));
        playerViewContainer.innerHTML = '';
        pageTitleElement.style.display = 'block';

        if (view === 'player' && songIdParam !== null && songsData[songIdParam]) {
            playerViewContainer.classList.add('active');
            const songId = parseInt(songIdParam); const track = songsData[songId];
            const playerDiv = createPlayerElement(track, songId, false); playerViewContainer.appendChild(playerDiv);
            playerViewContainer.scrollTop = 0;
            playerDiv.shouldAutoPlay = true; initializeAudioForPlayer(playerDiv, true);
            setMetaTags({ title: `üéß ${track.title} - Nekohacker591`, description: `Listen to "${track.title}" by Nekohacker591.`, url: window.location.href, type: 'music.song', audioUrl: track.file, imageUrl: track.artwork || defaultArtwork, trackIdForEmbed: songId });
            pageTitleElement.style.display = 'none';
        } else if (view === 'music') {
            musicContent.classList.add('active'); document.querySelector('.nav-link[data-view="music"]').classList.add('active');
            const currentSearch = searchQuery || '';
            musicSearchInput.value = currentSearch.replace(/\+/g, ' ');
            const filtered = songsData.filter(t => t.title.toLowerCase().includes(currentSearch.toLowerCase()));
            populateSongList(filtered);
            setMetaTags({ title: 'Music - Nekohacker591 Portfolio' });
        } else { // home
            homeContent.classList.add('active'); document.querySelector('.nav-link[data-view="home"]').classList.add('active');
            setMetaTags();
        }
    }
    
    sidebarToggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('sidebar-open');
        updateSidebarToggleIcon();
    });
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault(); const targetView = link.dataset.view; const url = new URL(window.location);
        const currentParams = new URLSearchParams(url.search); const currentView = currentParams.get('view') || 'home';
        if (targetView === currentView && !(targetView === 'player' && currentParams.get('songId') !== link.dataset.songId)) {
             if (window.innerWidth < 769 && document.body.classList.contains('sidebar-open')) { document.body.classList.remove('sidebar-open'); updateSidebarToggleIcon(); }
            return;
        }
        if (targetView === 'home') { url.searchParams.delete('view'); url.searchParams.delete('s'); url.searchParams.delete('songId'); }
        else { url.searchParams.set('view', targetView); url.searchParams.delete('songId'); }
        window.history.pushState({ view: targetView }, '', url); renderView();
        if (window.innerWidth < 769 && document.body.classList.contains('sidebar-open')) { document.body.classList.remove('sidebar-open'); updateSidebarToggleIcon(); }
      });
    });
    if (musicSearchInput) {
        musicSearchInput.addEventListener('input', () => {
            const query = musicSearchInput.value.toLowerCase();
            const url = new URL(window.location);
            if (query) url.searchParams.set('s', query.replace(/ /g, '+')); else url.searchParams.delete('s');
            if (document.getElementById('music-content').classList.contains('active')) {
                 window.history.replaceState({ view: 'music', s: query }, '', url);
                 renderView(); 
            }
        });
    }
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        let activeAudio = globalPlayerState.currentPlayingAudio; let activePlayerDiv = globalPlayerState.currentPlayingPlayerDiv;
        if (!activeAudio && playerViewContainer.classList.contains('active')) { activePlayerDiv = playerViewContainer.querySelector('.player'); if (activePlayerDiv && activePlayerDiv.audio) activeAudio = activePlayerDiv.audio; }
        if (e.code === 'Space') { e.preventDefault(); if (activePlayerDiv) activePlayerDiv.querySelector('.play-btn')?.click(); } // Note: .play-btn directly now
        else if (e.code === 'KeyM') { e.preventDefault(); if (activePlayerDiv) activePlayerDiv.querySelector('.mute-btn')?.click(); } // Note: .mute-btn directly
        else if (activeAudio && activePlayerDiv) {
            let handled = false; const cT = activeAudio.currentTime, dur = activeAudio.duration, vol = activeAudio.volume;
            if(e.code==='ArrowLeft'){if(dur&&dur!==Infinity)activeAudio.currentTime=Math.max(0,cT-5);handled=true;}
            else if(e.code==='ArrowRight'){if(dur&&dur!==Infinity)activeAudio.currentTime=Math.min(dur,cT+5);handled=true;}
            else if(e.code==='ArrowUp'){activeAudio.muted=false;activeAudio.volume=Math.min(1,vol+0.05);handled=true;}
            else if(e.code==='ArrowDown'){activeAudio.muted=false;activeAudio.volume=Math.max(0,vol-0.05);handled=true;}
            if(handled)e.preventDefault();
        }
    });
    window.addEventListener('popstate', (event) => { renderView(); });
    document.addEventListener('DOMContentLoaded', () => {
        setupIcons();
        if (autoplayCheckboxSidebar) {
            const storedAutoplay = localStorage.getItem('nekohacker_autoplayNext');
            autoplayCheckboxSidebar.checked = storedAutoplay !== null ? JSON.parse(storedAutoplay) : true;
            autoplayCheckboxSidebar.addEventListener('change', (e) => { globalPlayerState.autoplayNext = e.target.checked; });
        }
        renderView();
    });
  </script>
</body>
</html>
